import{Z as _,V as B}from"./chunks/theme.CFNbPdFi.js";import{C as P,N as v}from"./chunks/circuit.y_FAFz-t.js";import{P as F}from"./chunks/progress-bar.DdOpSzUH.js";import{d as I,p as i,q as C,v as T,x as V,c as x,o as b,G as n,k as q,w as A,j as e,_ as O,C as j,a2 as N,a as c}from"./chunks/framework.DYiJ1WDi.js";const M={class:"cache"},S={class:"content"},R={class:"form"},U={class:"row"},H={class:"row"},K={class:"visualization"},L={class:"row"},z={class:"row"},G=I({__name:"cache",setup(D){const l=i(null),s=i(3e3),t=i(5e3),d=i(0),h=i(0),p=i(0),u=i(0),g=i(0),o=i("var(--vp-c-green-2)"),a=new _({ttl:s.value,cacheClearInterval:t.value,adjustCacheParams:()=>[]}),w=new B({options:{modules:[a]}});C([s],()=>{a.ttl=s.value}),C([t],()=>{a.cacheClearInterval=t.value});function y(){h.value&&h.value<s.value||(o.value="var(--vp-c-green-2)",p.value=Date.now(),u.value=window.setInterval(()=>{d.value=Date.now()-p.value,d.value>=l.value.duration&&clearInterval(u.value)},100),g.value=window.setInterval(()=>{h.value=Date.now()-p.value,h.value>=s.value&&(o.value="var(--vp-c-yellow-2)",clearInterval(g.value))},100))}function E(){l.value.logs.push("Hitting cache.")}function f(){l.value.logs.push("Hitting old cache on failure.")}return T(()=>{a.on("execute",y),a.on("cache-hit",E),a.on("cache-hit-old",f)}),V(()=>{a.off("execute",y),a.off("cache-hit",E),a.off("cache-hit-old",f)}),($,r)=>(b(),x("div",M,[n(P,{ref_key:"circuitRef",ref:l,circuit:q(w)},{default:A(()=>{var m;return[e("div",S,[e("div",R,[e("div",U,[n(v,{modelValue:s.value,"onUpdate:modelValue":r[0]||(r[0]=k=>s.value=k),label:"TTL (in ms):"},null,8,["modelValue"])]),e("div",H,[n(v,{modelValue:t.value,"onUpdate:modelValue":r[1]||(r[1]=k=>t.value=k),label:"Clear Interval (in ms):"},null,8,["modelValue"])])]),e("div",K,[e("div",L,[n(F,{class:"progress",modelValue:d.value,max:(m=l.value)==null?void 0:m.duration,label:"Progress:"},null,8,["modelValue","max"])]),e("div",z,[n(F,{class:"internal",modelValue:h.value,color:o.value,max:s.value,label:"Cache Duration:"},null,8,["modelValue","color","max"])])])])]}),_:1},8,["circuit"])]))}}),J=O(G,[["__scopeId","data-v-c88518cc"]]),ss=JSON.parse('{"title":"Cache","description":"","frontmatter":{},"headers":[],"relativePath":"guide/api/modules/cache.md","filePath":"guide/api/modules/cache.md"}'),Z={name:"guide/api/modules/cache.md"},es=Object.assign(Z,{setup(D){return(l,s)=>{const t=j("ClientOnly");return b(),x("div",null,[s[0]||(s[0]=e("h1",{id:"cache",tabindex:"-1"},[c("Cache "),e("a",{class:"header-anchor",href:"#cache","aria-label":'Permalink to "Cache"'},"​")],-1)),s[1]||(s[1]=e("p",null,[c("The "),e("code",null,"Cache"),c(" module allows you to "),e("strong",null,"cache"),c(" your results for a configurable amount of time.")],-1)),n(t,null,{default:A(()=>[n(J)]),_:1}),s[2]||(s[2]=N(`<h2 id="usage" tabindex="-1">Usage <a class="header-anchor" href="#usage" aria-label="Permalink to &quot;Usage&quot;">​</a></h2><p>Once you call a <strong>function</strong>, with some <strong>parameters</strong>, it will check if it has been cached, if so, the function will not be called at all, and will directly resolve with the cached response.</p><blockquote><p>It is important to understand that the cache works by reference!<br> That means that the cache is specifically referenced <strong>for one function</strong>, and <strong>for the same parameters</strong>.<br></p></blockquote><p>Also, when a circuit fails and have an outdated cached response (ttl has been passed), the circuit will fire the request, and will respond with the new value if it succeeds, otherwise it will resolve with the cached response.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Mollitia </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;mollitia&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Creates a circuit</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> circuit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Mollitia.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Circuit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  options: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    modules: [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Creates a cache module</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Mollitia.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ttl: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// A cached response will be considered as valid for 1 minute</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cacheClearInterval: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">900000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // A cached response will be kept for 15 minutes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// If the result is a success, it will be cached.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> circuit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myFirstFunction).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// If this function is called before 1 minute is elapsed, the cached response will be returned</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> circuit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myFirstFunction).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This is a simple object</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> myObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  myFirstParam: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;myFirstValue&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Same as before, if that&#39;s a success, the result is cached. (The params are different, so it does not return the cache from before)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> circuit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myFirstFunction).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myObject);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// The objects changes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">myObject.myFirstParam </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;myFirstValuesModified&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Nevermind, the cache works by reference, meaning the cached result is returned.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> circuit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myFirstFunction).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myObject);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// That won&#39;t return the cached result, as the function is different</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> circuit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mySecondFunction).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myObject);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ... After 1 minute, the function is called again.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">circuit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myFirstFunction).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myObject)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // If the request succeeds, it returns the result normally</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // If not, the old cached response is returned</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// After 15 minutes, the cache is cleared.</span></span></code></pre></div><h2 id="api-reference" tabindex="-1">API Reference <a class="header-anchor" href="#api-reference" aria-label="Permalink to &quot;API Reference&quot;">​</a></h2><h3 id="options" tabindex="-1">Options <a class="header-anchor" href="#options" aria-label="Permalink to &quot;Options&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">Name</th><th style="text-align:left;">Description</th><th style="text-align:left;">Default</th></tr></thead><tbody><tr><td style="text-align:left;"><code>ttl</code></td><td style="text-align:left;">The amount of time during which a cached result is considered valid.</td><td style="text-align:left;"><code>6000</code></td></tr><tr><td style="text-align:left;"><code>cacheClearInterval</code></td><td style="text-align:left;">The amount of time before the cache cleans itself up.</td><td style="text-align:left;"><code>900000</code></td></tr><tr><td style="text-align:left;"><code>getInformationFromCache</code></td><td style="text-align:left;">Specifies if the async response is retrieved from Cache (<code>res._mollitiaIsFromCache</code> is <code>true</code>)</td><td style="text-align:left;"><code>false</code></td></tr><tr><td style="text-align:left;"><code>adjustCacheParams</code></td><td style="text-align:left;">A filtering callback, to modify the parameters used for Cache Key.</td><td style="text-align:left;"><code>none</code></td></tr></tbody></table><h3 id="methods" tabindex="-1">Methods <a class="header-anchor" href="#methods" aria-label="Permalink to &quot;Methods&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">Name</th><th style="text-align:left;">Description</th><th style="text-align:left;">Returns</th></tr></thead><tbody><tr><td style="text-align:left;"><code>getExecParams()</code></td><td style="text-align:left;">Returns the circuit function parameters.</td><td style="text-align:left;"><code>any[]</code> <strong>params</strong></td></tr></tbody></table><h3 id="events" tabindex="-1">Events <a class="header-anchor" href="#events" aria-label="Permalink to &quot;Events&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">Name</th><th style="text-align:left;">Description</th><th style="text-align:left;">Params</th></tr></thead><tbody><tr><td style="text-align:left;"><code>execute</code></td><td style="text-align:left;">Called when the module is executed.</td><td style="text-align:left;"><code>Mollitia.Circuit</code> <strong>circuit</strong>, <code>Promise&lt;T&gt;</code> <strong>promise</strong>, <code>any[]</code> <strong>params</strong></td></tr><tr><td style="text-align:left;"><code>cache-hit</code></td><td style="text-align:left;">Called when the module returns a cached result.</td><td style="text-align:left;"><code>Mollitia.Circuit</code> <strong>circuit</strong>, <code>any[]</code> <strong>cacheKeys</strong></td></tr><tr><td style="text-align:left;"><code>cache-hit-old</code></td><td style="text-align:left;">Called when the module returns an old cached result on failure.</td><td style="text-align:left;"><code>Mollitia.Circuit</code> <strong>circuit</strong>, <code>any[]</code> <strong>cacheKeys</strong></td></tr></tbody></table>`,12))])}}});export{ss as __pageData,es as default};
