import{_ as T}from"./chunks/circuit-breaker-diagram.Dq1YQUwR.js";import{D as f,r as B,V}from"./chunks/theme.CFNbPdFi.js";import{C as R,N as h}from"./chunks/circuit.y_FAFz-t.js";import{P as N}from"./chunks/progress-bar.DdOpSzUH.js";import{d as P,p as i,q as d,v as I,x as M,c as A,o as F,G as a,k as q,w as S,j as e,N as H,t as W,_ as U,C as z,a2 as L,a as j}from"./chunks/framework.DYiJ1WDi.js";const G={class:"sliding-time"},J={class:"content"},$={class:"form"},K={class:"row"},Q={class:"row"},X={class:"row"},Y={class:"row"},Z={class:"row"},ss={class:"row"},es={class:"row"},ts={class:"row"},is={class:"visualization"},as={class:"row state"},ls={class:"row"},ns=P({__name:"sliding-time",setup(_){const C=i(null),n=i(3e4),r=i(2),c=i(60),k=i(1e3),u=i(50),g=i(2),o=i(3e3),p=i(6e3),y=i(0),m=i(o.value),w=i(0),v=i(0),E=i("var(--vp-c-green-2)"),D=i(f.CLOSED),l=new B({slidingWindowSize:n.value,minimumNumberOfCalls:r.value,failureRateThreshold:c.value,slowCallDurationThreshold:k.value,slowCallRateThreshold:u.value,permittedNumberOfCallsInHalfOpenState:g.value,openStateDelay:o.value,halfOpenStateMaxDelay:p.value}),O=new V({options:{modules:[l]}});d([n],()=>{l.slidingWindowSize=n.value}),d([r],()=>{l.minimumNumberOfCalls=r.value}),d([c],()=>{l.failureRateThreshold=c.value}),d([k],()=>{l.slowCallDurationThreshold=k.value}),d([u],()=>{l.slowCallRateThreshold=u.value}),d([g],()=>{l.permittedNumberOfCallsInHalfOpenState=g.value}),d([o],()=>{l.openStateDelay=o.value}),d([p],()=>{l.halfOpenStateMaxDelay=p.value});function x(b){switch(clearInterval(v.value),y.value=0,D.value=b,b){case f.CLOSED:{E.value="var(--vp-c-green-2)";break}case f.HALF_OPENED:{m.value=p.value,E.value="var(--vp-c-yellow-2)";break}case f.OPENED:{m.value=o.value,E.value="var(--vp-c-red-2)";break}}w.value=Date.now(),D.value!==f.CLOSED?v.value=window.setInterval(()=>{y.value=Date.now()-w.value,y.value>=m.value&&clearInterval(v.value)},100):y.value=0}return I(()=>{l.on("state-changed",x)}),M(()=>{l.off("state-changed",x)}),(b,s)=>(F(),A("div",G,[a(R,{ref_key:"circuitRef",ref:C,circuit:q(O)},{default:S(()=>[e("div",J,[e("div",$,[e("div",K,[a(h,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=t=>n.value=t),label:"Window Size:"},null,8,["modelValue"])]),e("div",Q,[a(h,{modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=t=>r.value=t),label:"Minimum number of calls:"},null,8,["modelValue"])]),e("div",X,[a(h,{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=t=>c.value=t),label:"Failure Rate Threshold (in %):"},null,8,["modelValue"])]),e("div",Y,[a(h,{modelValue:k.value,"onUpdate:modelValue":s[3]||(s[3]=t=>k.value=t),label:"Slow Call Duration Threshold (in ms):"},null,8,["modelValue"])]),e("div",Z,[a(h,{modelValue:u.value,"onUpdate:modelValue":s[4]||(s[4]=t=>u.value=t),label:"Slow Call Rate Threshold (in %):"},null,8,["modelValue"])]),e("div",ss,[a(h,{modelValue:g.value,"onUpdate:modelValue":s[5]||(s[5]=t=>g.value=t),label:"Number of calls in Half Open State:"},null,8,["modelValue"])]),e("div",es,[a(h,{modelValue:o.value,"onUpdate:modelValue":s[6]||(s[6]=t=>o.value=t),label:"Delay to stay in Open State (in ms):"},null,8,["modelValue"])]),e("div",ts,[a(h,{modelValue:p.value,"onUpdate:modelValue":s[7]||(s[7]=t=>p.value=t),label:"Max Delay to stay in Half Open State (in ms):"},null,8,["modelValue"])])]),e("div",is,[e("div",as,[s[8]||(s[8]=e("label",null,"State:",-1)),e("div",{class:"bullet",style:H({backgroundColor:E.value})},null,4),e("span",null,W(D.value),1)]),e("div",ls,[a(N,{class:"internal",modelValue:y.value,color:E.value,max:m.value,label:"Breaker Duration:"},null,8,["modelValue","color","max"])])])])]),_:1},8,["circuit"])]))}}),hs=U(ns,[["__scopeId","data-v-f51f5ee3"]]),us=JSON.parse('{"title":"Sliding Time","description":"","frontmatter":{},"headers":[],"relativePath":"guide/api/modules/breaker/sliding-time.md","filePath":"guide/api/modules/breaker/sliding-time.md"}'),ds={name:"guide/api/modules/breaker/sliding-time.md"},gs=Object.assign(ds,{setup(_){return(C,n)=>{const r=z("ClientOnly");return F(),A("div",null,[n[0]||(n[0]=e("h1",{id:"sliding-time",tabindex:"-1"},[j("Sliding Time "),e("a",{class:"header-anchor",href:"#sliding-time","aria-label":'Permalink to "Sliding Time"'},"​")],-1)),a(r,null,{default:S(()=>[a(hs)]),_:1}),n[1]||(n[1]=L(`<h2 id="usage" tabindex="-1">Usage <a class="header-anchor" href="#usage" aria-label="Permalink to &quot;Usage&quot;">​</a></h2><p>The Circuit Breaker has 3 possible states:</p><ul><li><code>CLOSED</code></li><li><code>OPEN</code></li><li><code>HALF_OPEN</code></li></ul><p>When the circuit is opened, all the iterations are failing fast</p><p>When the circuit is half opened, a certain number of iterations are authorized. When this number is reached, the failure and slow call rate thresholds are checked to see if the circuit should be opened or closed.</p><p>When the circuit is closed, a sliding window is used to store the outcome of calls. The time-based sliding window calculates the outcome of the last calls received during the last N milliseconds, and decides if the circuit should be opened (if the failure or slow call rate thresholds are exceeded) For example, if the time window size is 10000, the circular array stores the iterations that occurred during the last 10s (with a maximum of 1000 elements in the array)</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Mollitia </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;mollitia&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Creates a circuit</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> circuit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Mollitia.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Circuit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my-circuit&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  options: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    modules: [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			// Creates Sliding Time Breaker Module</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Mollitia.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SlidingTimeBreaker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my-sliding-time-breaker&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				slidingWindowSize: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Failure Rate Calculation is done on the iterations received during the last 30s.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				minimumNumberOfCalls: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2 iterations are needed to start calculating the failure rate, and see if circuit should be opened or not</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				failureRateThreshold: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// If at least 60% of the iterations are failing, the circuit is switched to Opened state.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				slowCallDurationThreshold: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// An iteration is considered as being slow if the iteration lasts more than 0.5s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				slowCallRateThreshold: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">40</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// If at least 40% of the iterations are considered as being slow, the circuit is switched to Opened state.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				permittedNumberOfCallsInHalfOpenState: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// When the circuit is in Half Opened state, the circuit accepts 2 iterations in this state.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">				// Once these 2 iterations are received, failure rate is calculated on these iterations.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">				// If failure rate is lower than failureRateThreshold, the circuit is switched to Closed.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">				// If the failure rate is higher or equal to failureRateThreshold, the circuit is switched to Opened.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				openStateDelay: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // The circuit stays in Opened state for 10s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Time is t0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> circuit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myFunction).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 10s later (t0 + 10s)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// When this 2nd iteration is received, failureRate and slowCallRate is calculated</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// If the 2 iterations lasts less than 500ms and are all success, then the circuit is still closed</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// The circuit is opened if:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   - the 2 iterations failed (as failureRateThreshold is 60%)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   - at least 1 iteration is slow (as slowCallRateThreshold is 40%)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> circuit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myFunction2).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 10s later (t0 + 20s)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Elapsed time since 1st iteration is lower than 30s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// If circuit is still closed, the failureRate and slowCallRate threshold is calculated on the 3 iterations </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> circuit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myFunction3).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 5s later (t0 + 25s)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Elapsed time since 1st iteration is lower than 30s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// If circuit is still closed, the failureRate and slowCallRate threshold is calculated on the 4 iterations</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> circuit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myFunction4).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 10s later (t0 + 35s)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Elapsed time since 1st iteration is greater than 30s. Elapsed time since 2nd iteration is lower than 30s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// If circuit is still closed, the failureRate and slowCallRate threshold is now calculated on iterations from 2 to 5, as iteration 1 is too old</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> circuit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myFunction5).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p><img src="`+T+'" alt="Circuit Breaker - Diagram"></p><h2 id="api-reference" tabindex="-1">API Reference <a class="header-anchor" href="#api-reference" aria-label="Permalink to &quot;API Reference&quot;">​</a></h2><h3 id="options" tabindex="-1">Options <a class="header-anchor" href="#options" aria-label="Permalink to &quot;Options&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">Name</th><th style="text-align:left;">Description</th><th style="text-align:left;">Default</th></tr></thead><tbody><tr><td style="text-align:left;"><code>state</code></td><td style="text-align:left;">Specifies the circuit state</td><td style="text-align:left;"><code>CLOSED</code></td></tr><tr><td style="text-align:left;"><code>failureRateThreshold</code></td><td style="text-align:left;">Specifies the failure rate threshold in percentage</td><td style="text-align:left;"><code>50</code></td></tr><tr><td style="text-align:left;"><code>slowCallRateThreshold</code></td><td style="text-align:left;">Specifies the slow duration threshold. A call is considered <strong>slow</strong> when duration <code>&gt;=</code> than <code>slowCallDurationThreshold</code></td><td style="text-align:left;"><code>100</code></td></tr><tr><td style="text-align:left;"><code>slowCallDurationThreshold</code></td><td style="text-align:left;">Specifies the duration (in ms) threshold above which calls are considered as slow</td><td style="text-align:left;"><code>60000</code></td></tr><tr><td style="text-align:left;"><code>permittedNumberOfCallsInHalfOpenState</code></td><td style="text-align:left;">Specifies the number of permitted calls when the circuit is half open</td><td style="text-align:left;"><code>2</code></td></tr><tr><td style="text-align:left;"><code>halfOpenStateMaxDelay</code></td><td style="text-align:left;">Specifies the maximum wait (in ms) in Half Open State, before switching back to open. 0 deactivates this</td><td style="text-align:left;"><code>0</code></td></tr><tr><td style="text-align:left;"><code>slidingWindowSize</code></td><td style="text-align:left;">Specifies the sliding duration (in ms) used to calculate failure and slow call rate percentages</td><td style="text-align:left;"><code>60</code></td></tr><tr><td style="text-align:left;"><code>minimumNumberOfCalls</code></td><td style="text-align:left;">Specifies the minimum number of calls used to calculate failure and slow call rate percentages</td><td style="text-align:left;"><code>10</code></td></tr><tr><td style="text-align:left;"><code>openStateDelay</code></td><td style="text-align:left;">Specifies the time (in ms) the circuit stay opened before switching to half-open</td><td style="text-align:left;"><code>60000</code></td></tr><tr><td style="text-align:left;"><code>onError</code></td><td style="text-align:left;">Allows filtering of the error to report as a failure or not.</td><td style="text-align:left;"><code>None</code></td></tr></tbody></table><h3 id="methods" tabindex="-1">Methods <a class="header-anchor" href="#methods" aria-label="Permalink to &quot;Methods&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">Name</th><th style="text-align:left;">Description</th><th style="text-align:left;">Returns</th></tr></thead><tbody><tr><td style="text-align:left;"><code>getExecParams()</code></td><td style="text-align:left;">Returns the circuit function parameters.</td><td style="text-align:left;"><code>any[]</code> <strong>params</strong></td></tr></tbody></table><h3 id="events" tabindex="-1">Events <a class="header-anchor" href="#events" aria-label="Permalink to &quot;Events&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">Name</th><th style="text-align:left;">Description</th><th style="text-align:left;">Params</th></tr></thead><tbody><tr><td style="text-align:left;"><code>execute</code></td><td style="text-align:left;">Called when the module is executed.</td><td style="text-align:left;"><code>Mollitia.Circuit</code> <strong>circuit</strong>, <code>Promise&lt;T&gt;</code> <strong>promise</strong>, <code>any[]</code> <strong>params</strong></td></tr><tr><td style="text-align:left;"><code>state-changed</code></td><td style="text-align:left;">Called when the breaker state changes.</td><td style="text-align:left;"><code>Mollitia.BreakerState</code> <strong>state</strong></td></tr></tbody></table>',15))])}}});export{us as __pageData,gs as default};
