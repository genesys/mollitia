import{d as C,o as y,c as w,k as p,t as E,e as B,_ as T,g as F,p as $,m as V,u as L,h as S,r as W,H as _,l as A,n as U}from"./framework.b96a75df.js";import{V as Q}from"./theme.a2ff1341.js";var J=Object.defineProperty,X=(n,e,t)=>e in n?J(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,r=(n,e,t)=>(X(n,typeof e!="symbol"?e+"":e,t),t);const z=[];class G{constructor(e,t,s){r(this,"listeners"),r(this,"eventName"),r(this,"index"),this.listeners=e,this.eventName=t,this.index=s}dispose(){this.listeners[this.eventName].splice(this.index,1)}}class q{constructor(){r(this,"listeners"),this.listeners={}}on(e,t){this.listeners[e]=this.listeners[e]||[];const s=this.listeners[e].push(t);return new G(this.listeners,e,s-1)}off(e,t){const s=this.listeners[e];if(s){for(let i=s.length-1;i>0;i--)if(s[i]===t){s.splice(i,1);break}}}emit(e,...t){const s=this.listeners[e];return s?(s.forEach(i=>{i(...t)}),!0):!1}dispose(){this.listeners={}}}class O extends Error{constructor(){super("Circuit has no function set"),Object.setPrototypeOf(this,O.prototype)}}const Z=async()=>Promise.reject(new O),D=[];class _e extends q{constructor(e){var t;super(),r(this,"name"),r(this,"func"),r(this,"modules"),this.name=e!=null&&e.name?e.name:`Circuit${D.length}`;for(const s of z)s.onCircuitCreate&&s.onCircuitCreate(this,e==null?void 0:e.options);this.func=e!=null&&e.func?e.func:Z,this.modules=((t=e==null?void 0:e.options)==null?void 0:t.modules)||[],D.push(this)}get activeModules(){return this.modules.filter(e=>e.active)}fn(e){return this.func=e,this}async execute(...e){let t;if(this.activeModules.length)if(this.activeModules.length>1){const s=[];for(let i=2;i<this.activeModules.length;i++)s.push(this,this.activeModules[i].execute.bind(this.activeModules[i]));s.push(this,this.func,...e),t=this.activeModules[0].execute(this,this.activeModules[1].execute.bind(this.activeModules[1]),...s)}else t=this.activeModules[0].execute(this,this.func,...e);else t=this.func(...e);return this.emit("execute",this,t,e),t}dispose(){super.dispose(),this.modules&&this.modules.forEach(e=>e.dispose())}}const M=[];class v extends q{constructor(e){super(),r(this,"name"),r(this,"active"),r(this,"logger"),this.active=(e==null?void 0:e.active)!==void 0?e.active:!0,this.name=(e==null?void 0:e.name)!==void 0?e.name:`Module${M.length}`;for(const t of z)t.onModuleCreate&&t.onModuleCreate(this,e);this.logger=e==null?void 0:e.logger,M.push(this)}execute(e,t,...s){const i=t(...s),a=this.getExecParams(e,s);return this.emit("execute",e,i,a),i}getExecParams(e,t){const s=e.modules.findIndex(a=>a===this),i=t.length-(e.modules.length-1-s)*2;return t.filter((a,l)=>t.length-l<=i)}}class I extends Error{constructor(){super("Timed out"),Object.setPrototypeOf(this,I.prototype)}}class Ce extends v{constructor(e){super(e),r(this,"delay"),this.delay=(e==null?void 0:e.delay)!==void 0?e.delay:6e4}async execute(e,t,...s){const i=this._promiseTimeout(e,this.delay,t,...s),a=this.getExecParams(e,s);return this.emit("execute",e,i,a),i}async _promiseTimeout(e,t,s,...i){let a;return t!==0&&t!==1/0?Promise.race([s(...i),new Promise((l,o)=>{a=setTimeout(()=>{this.emitTimeout(e),o(new I)},t)})]).then(l=>(clearTimeout(a),l)).catch(l=>(clearTimeout(a),Promise.reject(l))):s(...i)}emitTimeout(e){var t;(t=this.logger)==null||t.debug(`${e.name}/${this.name} - Has timed out`),this.emit("timeout",e)}}async function k(n=1){return new Promise(e=>{setTimeout(()=>{e()},n)})}var K=(n=>(n.CONSTANT="constant",n.LINEAR="linear",n.EXPONENTIAL="exponential",n.JITTER="jitter",n))(K||{});class Te extends v{constructor(e){super(e),r(this,"attempts"),r(this,"interval"),r(this,"mode"),r(this,"factor"),r(this,"maxInterval"),r(this,"fastFirst"),r(this,"_jitterAdjustment"),r(this,"onRejection"),this.attempts=(e==null?void 0:e.attempts)??2,this.interval=(e==null?void 0:e.interval)??0,this.fastFirst=(e==null?void 0:e.fastFirst)??!1,this.maxInterval=(e==null?void 0:e.maxInterval)??1/0,this.mode=(e==null?void 0:e.mode)??"constant",this._jitterAdjustment=this.adjustJitterValue((e==null?void 0:e.jitterAdjustment)??.1);const t=this.mode==="linear"?1:2;this.factor=(e==null?void 0:e.factor)??t,this.onRejection=(e==null?void 0:e.onRejection)||(()=>!0)}get jitterAdjustment(){return this._jitterAdjustment}set jitterAdjustment(e){this._jitterAdjustment=this.adjustJitterValue(e)}adjustJitterValue(e){return Math.min(1,Math.max(0,e))}async execute(e,t,...s){const i=this._promiseRetry(e,this.attempts+1,t,...s),a=this.getExecParams(e,s);return this.emit("execute",e,i,a),i}async waitBeforeNextTry(e,t){let s=0;if(this.fastFirst){if(e===0)return this.emit("delay-before-next-retry",t,0),Promise.resolve();e--}switch(this.mode){case"linear":{s=Math.min(this.interval+this.interval*this.factor*e,this.maxInterval);break}case"exponential":{s=Math.min(this.interval*this.factor**e,this.maxInterval);break}case"jitter":{const i=Math.min(this.interval*this.factor**e,this.maxInterval),a=i*(1-this.jitterAdjustment),l=Math.min(i*(1+this.jitterAdjustment),this.maxInterval)-a;s=Math.floor(Math.random()*l)+a;break}case"constant":default:{s=Math.min(this.interval,this.maxInterval);break}}return this.emit("delay-before-next-retry",t,s),k(s)}async _promiseRetry(e,t,s,...i){var a,l;return t-1===0?(this.attempts&&(this.emit("retry",e,this.attempts),(a=this.logger)==null||a.debug(`${e.name}/${this.name} - Retry: (${this.attempts}/${this.attempts})`)),s(...i).then(o=>(this.attempts>0?this.emit("success-with-retry",e,this.attempts):this.emit("success-without-retry",e),o)).catch(o=>{throw this.attempts>0?this.emit("failure-with-retry",e,this.attempts):this.emit("failure-without-retry",e),o})):(t!==this.attempts+1&&(this.emit("retry",e,this.attempts-t+1),(l=this.logger)==null||l.debug(`${e.name}/${this.name} - Retry: (${this.attempts-t+1}/${this.attempts})`)),s(...i).then(o=>(t!==this.attempts+1?this.emit("success-with-retry",e,this.attempts-t+1):this.emit("success-without-retry",e),o)).catch(async o=>{const u=this.onRejection(o,this.attempts-t+1);return u===!1?(t!==this.attempts+1?this.emit("failure-with-retry",e,this.attempts-t+1):this.emit("failure-without-retry",e),Promise.reject(o)):(typeof u=="number"?(this.emit("delay-before-next-retry",e,u),await k(u)):await this.waitBeforeNextTry(this.attempts-t+1,e),this._promiseRetry(e,t-1,s,...i))}))}}class qe extends v{constructor(e){super(e),r(this,"callback"),this.callback=(e==null?void 0:e.callback)||(t=>t)}async execute(e,t,...s){const i=this._promiseFallback(e,t,...s),a=this.getExecParams(e,s);return this.emit("execute",e,i,a),i}async _promiseFallback(e,t,...s){return new Promise((i,a)=>{t(...s).then(l=>{i(l)}).catch(l=>{a(this.callback(l))})})}}class Y{constructor(e,t){r(this,"ttl"),r(this,"res"),this.ttl=e,this.res=t}}class ee{constructor(){r(this,"map"),this.map=new Map}set(e,...t){this._setLoopMap(this.map,e,...t)}get(...e){return this._getLoopMap(this.map,...e)}clear(){return this._clearLoopMap(this.map)}_setLoopMap(e,t,...s){if(s.length===2){const i={map:new Map,cache:new Y(Date.now()+t,s[1])};e.set(s[0],i)}else if(e.get(s[0])){const i=s.splice(0,1)[0];this._setLoopMap(e.get(i).map,t,...s)}else{const i=new Map;e.set(s[0],{map:i}),s.splice(0,1),this._setLoopMap(i,t,...s)}}_getLoopMap(e,...t){if(e){if(t.length===1)return e.get(t[0])&&e.get(t[0]).cache;{const s=t.splice(0,1)[0];return e.get(s)?this._getLoopMap(e.get(s).map,...t):null}}else return null}_clearLoopMap(e){let t=!1;return e.forEach(s=>{s.map&&this._clearLoopMap(s.map)===!0&&(t=!0),s.cache&&Date.now()>s.cache.ttl&&(delete s.cache,t=!0)}),t}}class Oe extends v{constructor(e){super(e),r(this,"ttl"),r(this,"getInformationFromCache"),r(this,"adjustCacheParams"),r(this,"cache"),r(this,"_cacheClearInterval"),r(this,"_cacheInterval"),this.ttl=(e==null?void 0:e.ttl)!==void 0?e.ttl:6e3,this.getInformationFromCache=(e==null?void 0:e.getInformationFromCache)!==void 0?e.getInformationFromCache:!1,this.adjustCacheParams=(e==null?void 0:e.adjustCacheParams)||null,this._cacheInterval=null,this._cacheClearInterval=0,this.cacheClearInterval=(e==null?void 0:e.cacheClearInterval)!==void 0?e.cacheClearInterval:9e5,this.cache=new ee}get cacheClearInterval(){return this._cacheClearInterval}set cacheClearInterval(e){this._cacheClearInterval=e,this._initializeInterval()}async execute(e,t,...s){const i=this._promiseCache(e,t,...s),a=this.getExecParams(e,s);return this.emit("execute",e,i,a),i}dispose(){super.dispose(),this._cacheInterval&&(clearTimeout(this._cacheInterval),this._cacheInterval=null)}async _promiseCache(e,t,...s){return new Promise((i,a)=>{var l;const o=this.getExecParams(e,s);let u=o;this.adjustCacheParams&&(u=this.adjustCacheParams(e.func,...o));const h=this.cache.get(e.func,...u);if(h){typeof h.res=="object"&&this.getInformationFromCache&&(h.res._mollitiaIsFromCache=!0);const c=Date.now();this.ttl!==1/0&&h.ttl<c?t(...s).then(m=>{this.ttl>0&&this.cache.set(this.ttl,e.func,...u,m),typeof m=="object"&&this.getInformationFromCache&&(m._mollitiaIsFromCache=!1),i(m)}).catch(()=>{var m;(m=this.logger)==null||m.debug(`${e.name}/${this.name} - Cache: Hit [Old]`),this.emit("cache-hit-old",e,u),i(h.res)}):((l=this.logger)==null||l.debug(`${e.name}/${this.name} - Cache: Hit`),this.emit("cache-hit",e,u),i(h.res))}else t(...s).then(c=>{this.ttl>0&&this.cache.set(this.ttl,e.func,...u,c),typeof c=="object"&&this.getInformationFromCache&&(c._mollitiaIsFromCache=!1),i(c)}).catch(c=>{a(c)})})}_initializeInterval(){this._cacheInterval&&(clearTimeout(this._cacheInterval),this._cacheInterval=null),this.cacheClearInterval!==0&&this.cacheClearInterval!==1/0&&(this._cacheInterval=setTimeout(()=>{var e;this.cache.clear()&&((e=this.logger)==null||e.debug(`${this.name} - Cache: Clear`)),this._initializeInterval()},this.cacheClearInterval))}}const te=2147483647;class P extends Error{constructor(){super("Circuit is overloaded"),Object.setPrototypeOf(this,P.prototype)}}class R extends Error{constructor(){super("Waiting for too long in queue"),Object.setPrototypeOf(this,R.prototype)}}class se extends q{constructor(e,...t){super(),r(this,"promise"),r(this,"params"),this.promise=e,this.params=t}async execute(){return new Promise((e,t)=>{this.emit("execute"),this.promise(...this.params).then(s=>{this.emit("resolve",s),e(s)}).catch(s=>{this.emit("reject",s),t(s)})})}}class Ie extends v{constructor(e){super(e),r(this,"concurrentSize"),r(this,"queueSize"),r(this,"maxQueueWait"),r(this,"concurrentBuffer"),r(this,"queueBuffer"),this.concurrentSize=(e==null?void 0:e.concurrentSize)!==void 0?e.concurrentSize:10,this.queueSize=(e==null?void 0:e.queueSize)!==void 0?e.queueSize:10,this.maxQueueWait=(e==null?void 0:e.maxQueueWait)!==void 0?e.maxQueueWait:6e4,this.concurrentBuffer=[],this.queueBuffer=[]}async execute(e,t,...s){const i=this._promiseBulkhead(e,t,...s),a=this.getExecParams(e,s);return this.emit("execute",e,i,a),i}async _promiseBulkhead(e,t,...s){return new Promise((i,a)=>{const l=new se(t,...s);if(this.concurrentBuffer.length<this.concurrentSize)l.execute().then(o=>{i(o)}).catch(o=>{a(o)}).finally(()=>{this.concurrentBuffer.splice(this.concurrentBuffer.indexOf(l),1),this.emit("update-concurrent-buffer",e,this.concurrentBuffer),this._addBufferedPromise(e)}),this.concurrentBuffer.push(l),this.emit("update-concurrent-buffer",e,this.concurrentBuffer);else if(this.queueBuffer.length<this.queueSize){this.queueBuffer.push(l),this.emit("update-queue-buffer",e,this.queueBuffer);let o;this.maxQueueWait<=te&&(o=setTimeout(()=>{this.queueBuffer.splice(this.queueBuffer.indexOf(l),1),this.emit("update-queue-buffer",e,this.queueBuffer),h.dispose(),c.dispose(),a(new R)},this.maxQueueWait));const u=l.on("execute",()=>{u.dispose(),clearTimeout(o)}),h=l.on("resolve",m=>{clearTimeout(o),this.concurrentBuffer.splice(this.concurrentBuffer.indexOf(l),1),this.emit("update-concurrent-buffer",e,this.concurrentBuffer),h.dispose(),c.dispose(),this._addBufferedPromise(e),i(m)}),c=l.on("reject",m=>{clearTimeout(o),this.concurrentBuffer.splice(this.concurrentBuffer.indexOf(l),1),this.emit("update-concurrent-buffer",e,this.concurrentBuffer),h.dispose(),c.dispose(),this._addBufferedPromise(e),a(m)})}else a(new P)})}_addBufferedPromise(e){if(this.queueBuffer.length>0){const t=this.queueBuffer.splice(0,1)[0];this.emit("update-queue-buffer",e,this.queueBuffer),t.execute().catch(()=>{}),this.concurrentBuffer.push(t),this.emit("update-concurrent-buffer",e,this.concurrentBuffer)}}}class j extends Error{constructor(e,t){super("Ratelimited"),r(this,"remainingTimeInRatelimit"),this.name=t,this.remainingTimeInRatelimit=e,Object.setPrototypeOf(this,j.prototype)}}class Pe extends v{constructor(e){super(e),r(this,"limitPeriod"),r(this,"limitForPeriod"),r(this,"requestsTime"),this.limitPeriod=(e==null?void 0:e.limitPeriod)!==void 0?e.limitPeriod:0,this.limitForPeriod=(e==null?void 0:e.limitForPeriod)!==void 0?e.limitForPeriod:1/0,this.requestsTime=[]}async getState(){return new Promise(e=>{e({requests:this.requestsTime})})}async setState(e,t){return new Promise(s=>{s()})}async clearState(){return new Promise(e=>{this.requestsTime=[],e()})}async execute(e,t,...s){var i;let a;try{a=await this.getState()}catch(u){(i=this.logger)==null||i.warn(u)}a!=null&&a.requests&&(this.requestsTime=a==null?void 0:a.requests);const l=this._promiseRatelimit(e,t,...s),o=this.getExecParams(e,s);return this.emit("execute",e,l,o),l}async addCurrentRequest(e){var t;this.requestsTime.push(e);try{await this.setState([{key:"requests",value:this.requestsTime}],this.limitPeriod)}catch(s){(t=this.logger)==null||t.warn(s)}}async _promiseRatelimit(e,t,...s){var i;if(!this.limitPeriod)return t(...s);const a=new Date().getTime();if(this.requestsTime.length<this.limitForPeriod)return await this.addCurrentRequest(a),t(...s);{const l=a-this.requestsTime[0];return l>this.limitPeriod?(this.requestsTime.splice(0,1),await this.addCurrentRequest(a),t(...s)):((i=this.logger)==null||i.debug(`${e.name}/${this.name} - Ratelimited`),this.emit("ratelimit",e),Promise.reject(new j(this.limitPeriod-l,this.name)))}}}class x extends Error{constructor(){super("Circuit is opened"),Object.setPrototypeOf(this,x.prototype)}}class ie extends Error{constructor(){super("Max allowed requests reached"),Object.setPrototypeOf(this,x.prototype)}}var N=(n=>(n.CLOSED="closed",n.HALF_OPENED="half-opened",n.OPENED="opened",n))(N||{}),g=(n=>(n[n.SUCCESS=0]="SUCCESS",n[n.FAILURE=1]="FAILURE",n[n.TIMEOUT=2]="TIMEOUT",n))(g||{});class H extends v{constructor(e){super(e),r(this,"state"),r(this,"stateTimestamp"),r(this,"openStateDelay"),r(this,"halfOpenStateMaxDelay"),r(this,"slidingWindowSize"),r(this,"minimumNumberOfCalls"),r(this,"failureRateThreshold"),r(this,"slowCallRateThreshold"),r(this,"slowCallDurationThreshold"),r(this,"permittedNumberOfCallsInHalfOpenState"),r(this,"onError"),r(this,"halfOpenMaxDelayTimeout",0),r(this,"openTimeout",0),r(this,"nbRequestsInHalfOpenedState"),r(this,"requests"),r(this,"isInitialized",!1),this.state=(e==null?void 0:e.state)!==void 0?e.state:"closed",this.stateTimestamp=Date.now(),this.openStateDelay=(e==null?void 0:e.openStateDelay)!==void 0?e.openStateDelay:60*1e3,this.halfOpenStateMaxDelay=(e==null?void 0:e.halfOpenStateMaxDelay)!==void 0?e.halfOpenStateMaxDelay:0,this.slidingWindowSize=(e==null?void 0:e.slidingWindowSize)!==void 0?e.slidingWindowSize:10,this.minimumNumberOfCalls=(e==null?void 0:e.minimumNumberOfCalls)!==void 0?e.minimumNumberOfCalls:10,this.failureRateThreshold=(e==null?void 0:e.failureRateThreshold)!==void 0?e.failureRateThreshold:50,this.slowCallDurationThreshold=(e==null?void 0:e.slowCallDurationThreshold)!==void 0?e.slowCallDurationThreshold:6e4,this.slowCallRateThreshold=(e==null?void 0:e.slowCallRateThreshold)!==void 0?e==null?void 0:e.slowCallRateThreshold:100,this.permittedNumberOfCallsInHalfOpenState=(e==null?void 0:e.permittedNumberOfCallsInHalfOpenState)!==void 0?e.permittedNumberOfCallsInHalfOpenState:2,this.nbRequestsInHalfOpenedState=0,this.requests=[],this.onError=(e==null?void 0:e.onError)||(()=>!0)}reinitializeCounters(){this.nbRequestsInHalfOpenedState=0,this.requests=[]}onOpened(){this.reinitializeCounters()}onClosed(){this.reinitializeCounters()}onHalfOpened(){this.reinitializeCounters()}isSomeEnum(e,t){return Object.values(e).includes(t)}isValidTimestamp(e){return!("timestamp"in e)||"timestamp"in e&&typeof e.timestamp=="number"}isValidState(e){return!!(e&&typeof e=="object"&&"state"in e&&this.isSomeEnum(N,e.state)&&this.isValidTimestamp(e))}isValidRequest(e){return!!(e&&typeof e=="object"&&"result"in e&&this.isSomeEnum(g,e.result)&&this.isValidTimestamp(e))}isValidData(e){return(!e.state||this.isValidState(e.state))&&(!e.requests||Array.isArray(e.requests)&&!e.requests.some(t=>!this.isValidRequest(t)))}async execute(e,t,...s){var i;try{const o=await this.getState();this.isValidData(o)&&(this.requests=o.requests?o.requests.map(u=>u.timestamp?{result:u.result,timestamp:u.timestamp}:{result:u.result}):[],o.state&&(this.state=o.state.state,this.stateTimestamp=o.state.timestamp))}catch(o){(i=this.logger)==null||i.warn(o)}this.isInitialized||(this.isInitialized=!0,this.state==="opened"?await this.setHalfDelay():this.state==="half-opened"&&await this.setOpenDelay());const a=this._promiseBreaker(e,t,...s),l=this.getExecParams(e,s);return this.emit("execute",e,a,l),a}async _promiseBreaker(e,t,...s){var i;switch(this.state){case"opened":return(i=this.logger)==null||i.debug(`${e.name}/${this.name} - Circuit is opened`),Promise.reject(new x);case"half-opened":return this.executeInHalfOpened(t,...s);case"closed":default:return this.executeInClosed(t,...s)}}adjustRequestResult(e,t){return!t&&e===1?0:e}async setStateSecure(e,t){var s;try{await this.setState(e,t)}catch(i){(s=this.logger)==null||s.warn(i)}}async executeInHalfOpened(e,...t){if(this.nbRequestsInHalfOpenedState<this.permittedNumberOfCallsInHalfOpenState){this.nbRequestsInHalfOpenedState++;const{requestResult:s,response:i,shouldReportFailure:a}=await this.executePromise(e,...t);return this.requests.push({result:this.adjustRequestResult(s,a)}),await this.setStateSecure([{key:"requests",value:this.requests}]),this.requests.length==this.permittedNumberOfCallsInHalfOpenState&&this.checkCallRatesHalfOpen(this.open.bind(this),this.close.bind(this)),s===1?Promise.reject(i):Promise.resolve(i)}else return Promise.reject(new ie)}executePromise(e,...t){const s=new Date().getTime();return e(...t).then(i=>{const a=new Date().getTime();let l=0;return this.slowCallDurationThreshold!==0&&this.slowCallDurationThreshold!==1/0&&a-s>this.slowCallDurationThreshold&&(l=2),{requestResult:l,response:i,shouldReportFailure:!1}}).catch(i=>({requestResult:1,response:i,shouldReportFailure:this.onError(i)}))}checkCallRatesHalfOpen(e,t){const{nbSlow:s,nbFailure:i}=this.requests.reduce(this.getNbSlowAndFailure,{nbSlow:0,nbFailure:0});this.checkResult(s,i,this.requests.length)?t&&t():e()}checkResult(e,t,s){return!(this.slowCallRateThreshold<100&&e/s*100>=this.slowCallRateThreshold||this.failureRateThreshold<100&&t/s*100>=this.failureRateThreshold)}getNbSlowAndFailure(e,t){switch(t.result){case 1:e.nbFailure++;break;case 2:e.nbSlow++}return e}checkCallRatesClosed(){const{nbSlow:e,nbFailure:t}=this.requests.reduce(this.getNbSlowAndFailure,{nbSlow:0,nbFailure:0});return this.checkResult(e,t,this.requests.length)}async open(){this.state!=="opened"&&(this.clearHalfOpenTimeout(),this.state="opened",this.stateTimestamp=Date.now(),this.setHalfDelay(),this.onOpened(),await this.setStateSecure([{key:"state",value:{state:"opened",timestamp:Date.now()}},{key:"requests",value:""}]),this.emit("state-changed",this.state))}async halfOpen(){this.state!=="half-opened"&&(this.clearHalfOpenTimeout(),this.state="half-opened",this.stateTimestamp=Date.now(),this.setOpenDelay(),this.onHalfOpened(),await this.setStateSecure([{key:"state",value:{state:"half-opened",timestamp:Date.now()}},{key:"requests",value:""}]),this.emit("state-changed",this.state))}async close(){this.state!=="closed"&&(this.clearHalfOpenTimeout(),this.state="closed",this.stateTimestamp=Date.now(),this.onClosed(),await this.setStateSecure([{key:"state",value:{state:"closed",timestamp:Date.now()}},{key:"requests",value:""}]),this.emit("state-changed",this.state))}async setHalfDelay(){var e;const t=Date.now()-this.stateTimestamp;t>=this.openStateDelay?((e=this.logger)==null||e.debug(`${this.name} - Breaker: Half Open`),await this.halfOpen()):this.openTimeout=setTimeout(async()=>{var s;(s=this.logger)==null||s.debug(`${this.name} - Breaker: Half Open`),await this.halfOpen()},this.openStateDelay-t)}async setOpenDelay(){if(this.halfOpenStateMaxDelay){const e=Date.now()-this.stateTimestamp;e>=this.halfOpenStateMaxDelay?(this.halfOpenMaxDelayTimeout=0,await this.open()):this.halfOpenMaxDelayTimeout=setTimeout(async()=>{this.halfOpenMaxDelayTimeout=0,await this.open()},this.halfOpenStateMaxDelay-e)}}clearHalfOpenTimeout(){this.halfOpenMaxDelayTimeout&&(clearTimeout(this.halfOpenMaxDelayTimeout),this.halfOpenMaxDelayTimeout=0)}dispose(){super.dispose(),this.clearHalfOpenTimeout(),this.openTimeout&&(clearTimeout(this.openTimeout),this.openTimeout=0)}async getState(){return new Promise(e=>{e({requests:this.requests,state:{state:this.state,timestamp:this.stateTimestamp}})})}async setState(e,t){return new Promise(s=>{s()})}async clearState(){return new Promise(e=>{this.requests=[],e()})}}class Re extends H{constructor(e){super(e),this.slidingWindowSize=(e==null?void 0:e.slidingWindowSize)!==void 0?e.slidingWindowSize:10,this.slidingWindowSize<this.minimumNumberOfCalls&&(this.slidingWindowSize=this.minimumNumberOfCalls)}async executeInClosed(e,...t){const{requestResult:s,response:i,shouldReportFailure:a}=await this.executePromise(e,...t),l=this.adjustRequestResult(s,a);this.requests.push({result:l});const o=this.requests.length;let u=!1;return o>=this.minimumNumberOfCalls&&(o>this.slidingWindowSize&&(this.requests.splice(0,o-this.slidingWindowSize),u=!0,await this.setStateSecure([{key:"requests",value:this.requests}])),l!==g.SUCCESS&&(this.checkCallRatesClosed()||(await this.open(),u=!0))),u||await this.setStateSecure([{key:"requests",value:this.requests}]),s===g.FAILURE?Promise.reject(i):Promise.resolve(i)}}class je extends H{constructor(e){super(e),r(this,"maxSize"),this.slidingWindowSize=(e==null?void 0:e.slidingWindowSize)!==void 0?e.slidingWindowSize:60,this.maxSize=1e3}filterCalls(){let e=this.requests.length;e>=this.maxSize&&(this.requests.splice(0,1),e--);let t=!0;const s=new Date().getTime();for(let i=0;i<e&&t;i++)s-this.requests[0].timestamp>this.slidingWindowSize?this.requests.splice(0,1):t=!1}async executeInClosed(e,...t){const{requestResult:s,response:i,shouldReportFailure:a}=await this.executePromise(e,...t);this.filterCalls();const l=this.adjustRequestResult(s,a);this.requests.push({result:l,timestamp:new Date().getTime()});let o=!1;return this.requests.length>=this.minimumNumberOfCalls&&l!==g.SUCCESS&&(this.checkCallRatesClosed()||(await this.open(),o=!0)),o||await this.setStateSecure([{key:"requests",value:this.requests}],this.slidingWindowSize),s===g.FAILURE?Promise.reject(i):Promise.resolve(i)}}const ae={class:"number"},re={key:0,class:"label"},ne=["value","step"],le=C({__name:"number",props:{modelValue:{default:0},step:{default:1},label:{}},emits:["update:modelValue"],setup(n){const e=n;return(t,s)=>(y(),w("div",ae,[p("label",null,[e.label?(y(),w("span",re,E(e.label),1)):B("",!0),p("input",{type:"number",value:e.modelValue,step:e.step,onInput:s[0]||(s[0]=i=>t.$emit("update:modelValue",+i.target.value))},null,40,ne)])]))}});const oe=T(le,[["__scopeId","data-v-6500f491"]]),ue=n=>($("data-v-bc134cb5"),n=n(),V(),n),he={class:"toggle"},ce={class:"container"},me=["checked"],de=ue(()=>p("span",{class:"slider"},null,-1)),pe={key:0,class:"label"},fe=C({__name:"toggle",props:{modelValue:{type:Boolean,default:!0},offLabel:{default:"Off"},onLabel:{default:"On"}},emits:["update:modelValue"],setup(n){const e=n,t=F(()=>e.modelValue?e.onLabel:e.offLabel);return(s,i)=>(y(),w("div",he,[p("label",null,[p("span",ce,[p("input",{type:"checkbox",checked:e.modelValue,onInput:i[0]||(i[0]=a=>s.$emit("update:modelValue",a.target.checked))},null,40,me),de]),t.value?(y(),w("span",pe,E(t.value),1)):B("",!0)])]))}});const ve=T(fe,[["__scopeId","data-v-bc134cb5"]]),ge={class:"module"},ye={class:"actions"},we=["innerHTML"],xe=C({__name:"circuit",props:{circuit:{},duration:{default:500}},emits:["success","failure"],setup(n,{expose:e,emit:t}){const{isDark:s}=L(),i=n,a=t,l=F(()=>s.value?"dark":"light"),o=S(i.duration),u=S(!0),h=S([]);e({duration:o,logs:h});function c(){return new Promise((d,f)=>{window.setTimeout(()=>{u.value?d({message:"Normal Success"}):f(new Error("Normal Failure"))},o.value)})}async function m(){try{const d=await i.circuit.fn(c).execute({duration:o.value});h.value=[...h.value,d.message],a("success",d)}catch(d){h.value=[...h.value,d.message],a("failure",d)}}return(d,f)=>(y(),w("div",{class:U(["circuit",l.value])},[p("div",ge,[W(d.$slots,"default",{},void 0,!0)]),p("div",ye,[_(oe,{class:"delay",modelValue:o.value,"onUpdate:modelValue":f[0]||(f[0]=b=>o.value=b),label:"Duration (in ms):"},null,8,["modelValue"]),_(ve,{modelValue:u.value,"onUpdate:modelValue":f[1]||(f[1]=b=>u.value=b),"off-label":"Failure","on-label":"Success"},null,8,["modelValue"]),_(A(Q),{class:"send",text:"Execute",onClick:f[2]||(f[2]=()=>m())})]),p("div",{class:"logs",innerHTML:h.value.join("<br/>")},null,8,we)],2))}});const De=T(xe,[["__scopeId","data-v-0cb6dddd"]]);export{De as C,K as E,qe as G,oe as N,N as P,Ce as Q,ve as T,_e as V,Te as X,Oe as Z,Re as a,je as r,Pe as s,Ie as t};
